Nombre 				|  Agregar publicación
Actores				|  Usuario
Descripción			|  Permitir agregar nuevas publicaciones a la linea de tiempo.
Disparador			|  Desea dar a conocer algun tema, conversar o expresar su opinión mediante imágenes, texto, video, música, vínculos, etc.
Precondiciones		|  1. Debe estar identificado en el sistema,
					|  2. No debe ser un usuario banneado.
					|
Postcondiciones		|  1. Se crea la nueva publicación.
					|  2. Se informa a sus amigos sobre la misma.
					|  3. Se le muestra al usuario su publicación una vez realizada.
					|  4. Si hubo personas etiquetadas se les envia un correo electrónico notificando el hecho.
					|
Flujo Normal		|  1. El usuario solicita dar de alta una nueva publicación.
					|  2. El sistema muestra los campos a ser llenados.
					|	  a) Campo de publicación.
					|  3. Se validan los datos (E1)
					|  4. Si el usuario introdujo un vinculo en la caja de publicación se hace un scanneo del enlace y se muestra.
					|  5. Si el usuario introdujo un vinculo de youtube se embebe el video.
					|  6. Si se etiqueto un usuario se marca con un enlace a su perfil del mismo.
					|
Flujo alternativo	|  1. Si el usuario desea cancelar la operación 
					|     a) Se le pregunta si esta seguro.
					|     b) En caso de estar seguro se borra el contenido de la caja de texto junto con las etiquetas creadas.
					|  2. Si se introduce un vinculo y este no existe se omite este enlace.
					|  3. Si se inserta una imagen y ocurre un error se le informa al usuario y se omite la misma.
					|
Excepciones			|  E.1 No se cargo ningún texto.
					|  E.1.1 El sistema informa que no hay ninguna información a publicar.
					|  E.1.2 El sistema vuelve al paso 2 pudiendo el usuario cancelar la operación en cualquier momento.
					|
Prioridad			|  Alta
					|
Frecuencia de uso	|  Alta
					|
Reglas de negocio	|  Al crear una publicación solo se muestra la misma a los amigos del publicador.
					|
Requerimientos 		|
especiales			|
					|
Suposiciones		|
Notas y preguntas	|


Lang:

poststatus_attachment
poststatus_submit


Se generará una tabla la cual contendrá un índice de la acción a ejecutar,

publish_format_data

id: Autoincrement (Servirá para la url a fin de que haga busquedas por id)
configure_id: Es el id de relación que nos permitirá saber el formato que seguirá esa cadena para poderse mostrar y parsear. (El html u ouput se generá desde archivos que aprovechan el query y lo mandan a la vista, en el puede haber un header, left, footer predefinido pero sobreescribible, almacenado en other_global)
member_id: Usuario que genera la acción, solo por indexación
status_date: Int que guarda el timestamp de la acción realizada.

parents: Entidad relación con las tablas que queremos hacer inner join (En caso de obtener un arreglo vacio se ignora)
El formato de los parents ej:

field_date es la fecha que se extrae desde las tablas parent

Para saber si un estado a sido modificado y es necesario informar del mismo a los autores o involucrados, se marcara con un status_event en bool 1 o 0, 1 especifica que si hay acción realizada, una vez leída la acción será necesario cambiar el valor a 0.

Esto irá en la tabla de configuración general: publish_general_configuration
$parents[] = array
             ( 
                 array
                 (
                    'tableName'        => 'AquiIraElNombreDeLaTabla', //Obligatorio Se comprobará la existencia de la tabla
                    'fromId'           => 'AquiIraElIndiceDeRelacionDeNuestraTablaPrimaria', //Obligatorio se puede omitir solo en el primer arreglo, los posteriores deben tenerlo como obligatorio ya que es parte del ON.
                    'toId'             => 'AquiIraElIndiceDeRelacionDeLaTablaOrigen', //Obligatorio
                    'fieldsCollection' => array  //Opcional aunque mínimo algun elemento del arreglo deberá tener algún elemento a seleccionar en caso contrario se hará un SELECT *
                                          (
                                              'Aquí irá el campo 1', //Se comprobará que cada uno de los campos existe
                                              'Aquí irá el campo 2',
                                          ),
                 ),
                 array
                 (
                    'tableName' => 'AquiIraElNombreDeLaTabla',
                    'fromId'    => 'AquiIraElIndiceDeRelacionDeNuestraTablaPrimaria',
                    'toId'      => 'AquiIraElIndiceDeRelacionDeLaTablaOrigen',
                 ),
                 array
                 (
                    'tableName' => 'AquiIraElNombreDeLaTabla',
                    'fromId'    => 'AquiIraElIndiceDeRelacionDeNuestraTablaPrimaria',
                    'toId'      => 'AquiIraElIndiceDeRelacionDeLaTablaOrigen',
                 ),
             );
             
Tantos indices de relación tenga, es como habrá un serialize más grande.

Todos estos datos se van a cachear.

             

Una clase central que llevará las constantes y la interfaz de como se comportaran las inserciones en los diferentes metódos. Esta clase tendrá las constantes básicas para las diferentes clases en las que se hace la inserción de lo que se trabaja. (Bitácora), La cual se puede heredar para añadir nuevas constantes o funciones a la misma. Esta clase también tendrá las main querys y hará el retorno de datos. No tendrá ninguna vista en particular sobre la salida pero si permitirá una definción de las funciones que harán este trabajo.

Constantes 

//CONST UPDATES = 'status_update'; //Nombre de la clase que hereda a la clase principal para mostrar los datos.

Interface
Clase principal
Clase secundaría
Clases que usan la clase secundaría

La clase principal implementaria la clase secundaria y la secundaria a la interface

De la clase secundaria se hace el output


Identificar los elementos donde se hace el insert


Solo debemos mostrar publicaciones de nuestros propios amigos y las nuestras. A los invitados les mostraremos solo el perfil con las publicaciones publicas. Definiendo publicas aquellas que nosotros consideremos, es por ello que cada uno de los estados realizados directamente sobre el portal podrán elegir que tipo de actividad y privacidad deseamos por defecto será solo privacidad publica

______________________________________________________

Permitir cachear cada uno de los últimos 100 estados por cada usuario.

A las publicaciones les falta poder tener un where para poder determnar condicionantes


				$array = array
				         (
				                array
				                (
				                       'tableName'              => 'gallery_images',
				                       'toId'                   => 'id',
				                       'fieldsCollection'       => array
				                                                   (
				                                                            'caption', 'description', 'directory', 'masked_file_name', 'medium_file_name', 'file_type', 'caption_seo',
				                                                   ),
				                ),
				                array
				                (
				                       'tableName'              => 'gallery_albums_main',
				                       'fromId'                 => 'img_album_id',
				                       'toId'                   => 'album_id',
				                       'fieldsCollection'       => array
				                                                   (
				                                                            'album_name', 'album_name_seo', 'album_description',
				                                                   ),
				                ),
				         );
				         
               $array = array
                        (
                                array
                                (
                                      'tableName'               => 'member_status_updates',
                                      'toId'                    => 'status_id',
                                      'fieldsCollection'        => array
                                                                   (
                                                                        'status_content',
                                                                        'status_id',
                                                                   ),
                                ),

                        );
                        
                        
				$array = array
				         (
				                array
				                (
				                       'tableName'              => 'reputation_index',
				                       'toId'                   => 'id',
				                       'fieldsCollection'       => array
				                                                   (
				                                                            'type_id',
				                                                   ),
				                ),
				                array
				                (
				                       'tableName'              => '_reputation_index',
				                       'fromId'                 => 'type_id',
				                       'toId'                   => '_reputation_index_id',
				                       'fieldsCollection'       => array
				                                                   (
				                                                            '_reputation_index_fields',
				                                                   ),
				                       'isCallback'             => true,
				                       'tag'                    => 'pid',
				                ),
				                array
				                (
				                       'tableName'              => '_link_reputation_index',
				                       'fromId'                 => '_reputation_index_id',
				                       'toId'                   => '_link_reputation_index_id',
				                       'fieldsCollection'       => array
				                                                   (
				                                                            '_link_reputation_index_fields',
				                                                   ),
				                       'isCallback'             => true,
				                       'tag'                    => 'id',
				                ),
				         );
				         echo serialize($array);exit;

Pese a que existen tablas dinámicas de donde se extrae la información, deberemos decirle al sistema cuales son los querys que hacen uso de dichas tablas con el fin de poder armar correctamente la consulta, para ello se agregara un nuevo campo en la estructura del arreglo que se llamara isCallback el cual a true nos permitirá saber si el contenido de tableName se trata de una función para extraer información en base a la tabla que contiene la consulta.


--

INSERT INTO `adpjWzk92y_publish_general_configuration` (`id`, `field_date`, `field_author_id`, `parents`, `enabled`) VALUES
(1, 'status_date', 'status_author_id', 'a:1:{i:0;a:3:{s:9:"tableName";s:21:"member_status_updates";s:4:"toId";s:9:"status_id";s:16:"fieldsCollection";a:2:{i:0;s:14:"status_content";i:1;s:9:"status_id";}}}', 1),
(3, 'rep_date', 'member_id', 'a:1:{i:0;a:3:{s:9:"tableName";s:16:"reputation_index";s:4:"toId";s:2:"id";s:16:"fieldsCollection";a:1:{i:0;s:7:"type_id";}}}', 1),
(2, 'idate', 'member_id', 'a:2:{i:0;a:3:{s:9:"tableName";s:14:"gallery_images";s:4:"toId";s:2:"id";s:16:"fieldsCollection";a:7:{i:0;s:11:"id, caption";i:1;s:11:"description";i:2;s:9:"directory";i:3;s:16:"masked_file_name";i:4;s:16:"medium_file_name";i:5;s:9:"file_type";i:6;s:11:"caption_seo";}}i:1;a:4:{s:9:"tableName";s:19:"gallery_albums_main";s:6:"fromId";s:12:"img_album_id";s:4:"toId";s:8:"album_id";s:16:"fieldsCollection";a:3:{i:0;s:10:"album_name";i:1;s:14:"album_name_seo";i:2;s:17:"album_description";}}}', 1);
